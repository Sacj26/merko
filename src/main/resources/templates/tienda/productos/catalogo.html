<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{shared/layouts/public}"
      lang="es">
<head>
    <title>Catálogo de Productos</title>
    <link rel="stylesheet" th:href="@{/css/productos-publicos.css}" />
</head>
<body>
    <div layout:fragment="content">
        <section class="filtros">
            <input type="text" id="filtro-nombre" placeholder="Buscar por nombre...">
            <input type="number" id="filtro-precio" placeholder="Precio máximo">
        </section>

        <main class="contenedor-productos">
            <button class="btn-flecha izquierda" id="btn-izquierda"><i class="fa-solid fa-chevron-left"></i></button>

            <div class="grid-productos" id="catalogo">
                <div class="card-producto" th:each="producto : ${productos}"
                     th:data-id="${producto.id}"
                     th:data-nombre="${producto.nombre}"
                     th:data-precio="${producto.precioVenta}">

                    <img th:if="${producto.imagenUrl != null}"
                         th:src="@{/uploads/imagenes-productos/{img}(img=${#strings.substring(producto.imagenUrl, producto.imagenUrl.lastIndexOf('/') + 1)})}"
                         alt="Imagen del producto"
                         class="imagen-producto" />

                    <img th:unless="${producto.imagenUrl != null}"
                         th:src="@{/img/default-product.png}"
                         alt="Imagen por defecto"
                         class="imagen-producto" />

                    <div class="info-producto">
                        <h2 th:text="${producto.nombre}">Nombre</h2>
                        <p th:text="${producto.descripcion}">Descripción</p>
                        <span class="etiqueta">¡Nuevo!</span>
                        <p class="precio" th:text="'$' + ${producto.precioVenta}">Precio</p>
                        <p class="cantidad-disponible" th:text="'Disponible: ' + (${availableStockByProductId[producto.id] != null ? availableStockByProductId[producto.id] : 0})">Cantidad disponible</p>

                        <form th:action="@{/carrito/agregar}" method="post" class="form-agregar-carrito">
                            <input type="hidden" name="productoId" th:value="${producto.id}" />
                            <label>
                                Cantidad:
                                <input type="number" name="cantidad" value="1" min="1" th:attr="max=${availableStockByProductId[producto.id] != null ? availableStockByProductId[producto.id] : 0}" required />
                            </label>
                            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                            <button type="submit" class="btn-comprar">Agregar al carrito</button>
                        </form>
                    </div>
                </div>
            </div>

            <button class="btn-flecha derecha" id="btn-derecha"><i class="fa-solid fa-chevron-right"></i></button>
        </main>

        <section class="testimonios">
            <h2>Lo que dicen nuestros clientes</h2>
            <div class="grid-testimonios">
                <div class="testimonio">
                    <p>"Excelente atención y productos de calidad. Recomiendo totalmente Merko."</p>
                    <span>- Laura G.</span>
                </div>
                <div class="testimonio">
                    <p>"He comprado varias veces y siempre recibo lo que espero. ¡Felicitaciones!"</p>
                    <span>- José P.</span>
                </div>
            </div>
        </section>
    </div>

    <th:block layout:fragment="scripts">
        <script th:src="@{/js/filtro-productos.js}"></script>
        <script th:src="@{/js/carrito.js}"></script>
    </th:block>
</body>
</html>