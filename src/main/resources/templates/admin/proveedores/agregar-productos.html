<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{shared/layouts/admin}"
      lang="es">
<head>
    <title>Agregar Productos</title>
    <link rel="stylesheet" th:href="@{/css/pages/proveedores.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Inline override to ensure provider product form uses compact row layout (override cached/preceding CSS) -->
    <style>
        @media (min-width: 768px) {
            .proveedor-form .form-grid { display: grid !important; grid-template-columns: repeat(2, minmax(0, 1fr)); gap:1.25rem 2rem; }
            .proveedor-form .form-group { display:flex !important; flex-direction:row !important; align-items:center !important; gap:0.75rem !important; margin-bottom:1rem !important; width:100%; }
            .proveedor-form .form-group label{ flex:0 0 160px; margin:0; font-weight:600; }
            .proveedor-form .form-group .form-control{ flex:1 1 auto !important; width:auto !important; max-width:none !important; }
            .proveedor-form .form-group.full-width{ display:block !important; width:100% !important; grid-column:1 / -1 !important; }
        }
    </style>
</head>
<body>
<div layout:fragment="content">
    <div class="header-with-actions">
        <div class="title-group">
            <h1 class="page-title">
                Agregar Productos a 
                <span th:text="${proveedor.nombre}">Proveedor</span>
                <span th:if="${branch != null}"> — <span th:text="${branch.nombre}">Sucursal</span></span>
            </h1>
            <p class="page-subtitle" th:text="${branch != null} ? 'Agrega uno o más productos a la sucursal' : 'Agrega uno o más productos al proveedor'">Agrega productos</p>
        </div>
    </div>

    

    <div class="form-container">
    <form id="form-productos" th:action="${accion != null} ? ${accion} : @{/admin/proveedores/agregar-productos/{id}(id=${proveedor.id})}"
        method="post" enctype="multipart/form-data" class="form-admin proveedor-form" >
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        <input type="hidden" name="proveedorId" th:value="${proveedor != null ? proveedor.id : ''}" />
        <input type="hidden" name="branchId" th:value="${branch != null ? branch.id : ''}" />

        <!-- Sección: Productos -->
        <fieldset class="form-section">
                <legend>
                <i class="fas fa-box"></i> Productos
                <button type="button" class="btn-add-producto" onclick="agregarProducto()" title="Agregar producto">
                    <i class="fas fa-plus-circle" aria-hidden="true"></i> Agregar producto
                </button>
            </legend>

            <div id="productos-container">
                <div class="producto-item" data-producto-index="0">
                    <div class="producto-header">
                        <h4>Producto #1</h4>
                        <button type="button" class="btn-remove-producto" onclick="eliminarProducto(0)" title="Eliminar producto" aria-label="Eliminar producto">
                            <i class="fas fa-trash-alt" aria-hidden="true"></i>
                        </button>
                    </div>
                    <div th:replace="~{shared/fragments/product-form-fields :: indexed('productos[0]')}"></div>
                </div>
            </div>
        </fieldset>

        <!-- Botones -->
        <div class="form-actions">
            <button type="submit" class="btn btn-primary" title="Guardar productos">
                <i class="fas fa-save" aria-hidden="true"></i> Guardar productos
            </button>
            <a th:href="@{/admin/proveedores}" class="btn btn-secondary" title="Cancelar" style="margin-left:8px;">
                <i class="fas fa-times-circle" aria-hidden="true"></i> Cancelar
            </a>
        </div>

        <!-- Mensaje de error -->
        <div th:if="${error}" class="alert alert-error">
            <span class="alert-icon"><i class="fas fa-exclamation-circle"></i></span>
            <div class="alert-content">
                <p class="alert-message" th:text="${error}">Error</p>
            </div>
        </div>

    </form>
    </div>
    </div>
</div>

<div layout:fragment="scripts">
    <script th:src="@{/js/pages/proveedores/agregar-productos.js}"></script>
</div>
</body>
</html>
