<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
            xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
            layout:decorate="~{shared/layouts/admin}"
            lang="es">
<head>
        <title th:text="${titulo}">Formulario Producto</title>
        <link rel="stylesheet" th:href="@{/css/components/formularios.css}" />
        <link rel="stylesheet" th:href="@{/css/components/buttons.css}" />
        <link rel="stylesheet" th:href="@{/css/pages/productos.css}" />
        <link rel="stylesheet" th:href="@{/css/modules/productos-form.css}" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
        
    </head>
    <body>
        <div layout:fragment="content">
            <div class="header-with-actions">
                <div class="title-group">
                    <h1 class="page-title" th:text="${titulo}">Formulario Producto</h1>
                    <p class="page-subtitle">Completa los datos del producto</p>
                </div>
            </div>

            <div class="form-container">
                <form th:action="@{${accion}}" th:object="${producto}" method="post" enctype="multipart/form-data" class="form-admin">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <input type="hidden" th:field="*{id}" />

                    <!-- Sección: Información básica -->
                    <div class="form-section">
                        <h3><i class="fas fa-info-circle"></i> Información básica</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="nombre">Nombre <span style="color:red;">*</span></label>
                                <input type="text" id="nombre" th:field="*{nombre}" class="form-control" placeholder="Nombre del producto" required />
                            </div>

                            <div class="form-group">
                                <label for="sku">SKU</label>
                                <input type="text" id="sku" th:field="*{sku}" class="form-control" placeholder="Código interno único" />
                            </div>

                            <div class="form-group">
                                <label for="codigoBarras">Código de Barras</label>
                                <input type="text" id="codigoBarras" th:field="*{codigoBarras}" class="form-control" placeholder="EAN/UPC" />
                            </div>

                            <div class="form-group">
                                <label for="marca">Marca</label>
                                <input type="text" id="marca" th:field="*{marca}" class="form-control" placeholder="Marca del producto" />
                            </div>

                            <div class="form-group">
                                <label for="tipo">Tipo <span style="color:red;">*</span></label>
                                <select id="tipo" th:field="*{tipo}" class="form-control" required>
                                    <option th:each="t : ${T(merko.merko.Entity.TipoProducto).values()}" th:value="${t}" th:text="${#strings.capitalize(#strings.replace(t.name(), '_', ' '))}"></option>
                                </select>
                                <small class="form-text text-muted">Materia prima (compras) o Producto terminado (ventas)</small>
                            </div>

                            <div class="form-group">
                                <label for="estado">Estado <span style="color:red;">*</span></label>
                                <select id="estado" th:field="*{estado}" class="form-control" required>
                                    <option th:each="e : ${T(merko.merko.Entity.EstadoProducto).values()}" th:value="${e}" th:text="${#strings.capitalize(#strings.replace(e.name(), '_', ' '))}"></option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="descripcion">Descripción <span style="color:red;">*</span></label>
                            <textarea id="descripcion" th:field="*{descripcion}" class="form-control" rows="3" placeholder="Descripción detallada del producto" required></textarea>
                        </div>
                    </div>

                    <!-- Sección: Presentación y unidades -->
                    <div class="form-section">
                        <h3><i class="fas fa-box"></i> Presentación y unidades</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="unidadMedida">Unidad de Medida <span style="color:red;">*</span></label>
                                <select id="unidadMedida" th:field="*{unidadMedida}" class="form-control" required>
                                    <option th:each="u : ${T(merko.merko.Entity.UnidadMedida).values()}" th:value="${u}" th:text="${#strings.capitalize(#strings.replace(u.name(), '_', ' '))}"></option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="contenidoNeto">Contenido Neto</label>
                                <input type="number" id="contenidoNeto" th:field="*{contenidoNeto}" class="form-control" step="0.01" min="0" placeholder="p. ej. 500" />
                            </div>

                            <div class="form-group">
                                <label for="contenidoUoM">Unidad del Contenido</label>
                                <select id="contenidoUoM" th:field="*{contenidoUoM}" class="form-control">
                                    <option value="">Seleccione</option>
                                    <option th:each="u : ${T(merko.merko.Entity.UnidadMedida).values()}" th:value="${u}" th:text="${#strings.capitalize(#strings.replace(u.name(), '_', ' '))}"></option>
                                </select>
                                <small class="form-text text-muted">Ej: si contenido neto es 500, unidad puede ser G (gramos) o ML</small>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Precios e inventario -->
                    <div class="form-section">
                        <h3><i class="fas fa-dollar-sign"></i> Precios e inventario</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="precioCompra">Precio de Compra</label>
                                <input type="number" id="precioCompra" th:field="*{precioCompra}" class="form-control" step="0.01" min="0" placeholder="0.00" />
                                <small class="form-text text-muted">Costo unitario (para materias primas)</small>
                            </div>

                            <div class="form-group">
                                <label for="precioVenta">Precio de Venta <span style="color:red;">*</span></label>
                                <input type="number" id="precioVenta" th:field="*{precioVenta}" class="form-control" step="0.01" min="0" placeholder="0.00" required />
                            </div>

                            <div class="form-group">
                                <label for="stock">Stock Actual <span style="color:red;">*</span></label>
                                <input type="number" id="stock" th:field="*{stock}" class="form-control" min="0" placeholder="0" required />
                            </div>

                            <div class="form-group">
                                <label for="stockMinimo">Stock Mínimo</label>
                                <input type="number" id="stockMinimo" th:field="*{stockMinimo}" class="form-control" min="0" placeholder="0" />
                            </div>

                            <div class="form-group">
                                <label for="puntoReorden">Punto de Reorden</label>
                                <input type="number" id="puntoReorden" th:field="*{puntoReorden}" class="form-control" min="0" placeholder="0" />
                            </div>

                            <div class="form-group">
                                <label for="leadTimeDias">Lead Time (días)</label>
                                <input type="number" id="leadTimeDias" th:field="*{leadTimeDias}" class="form-control" min="0" placeholder="0" />
                                <small class="form-text text-muted">Tiempo de reposición</small>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Proveedor -->
                    <div class="form-section">
                        <h3><i class="fas fa-truck"></i> Proveedor</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="proveedor">Proveedor <span style="color:#f39c12;">★</span></label>
                                <select id="proveedor" th:field="*{proveedor}" class="form-control">
                                    <option value="">-- Seleccione un proveedor --</option>
                                    <option th:each="prov : ${proveedores}" 
                                            th:value="${prov.id}" 
                                            th:text="${prov.nombre}"
                                            th:selected="${producto.proveedor != null && producto.proveedor.id == prov.id}">
                                    </option>
                                </select>
                                <small class="form-text text-muted">
                                    <i class="fas fa-info-circle"></i> Requerido para materias primas. 
                                    <span th:if="${producto.proveedor != null}" style="color: #27ae60; font-weight: 600;">
                                        Proveedor actual: <span th:text="${producto.proveedor.nombre}"></span>
                                    </span>
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Lotes y vencimientos -->
                    <div class="form-section">
                        <h3><i class="fas fa-calendar-alt"></i> Lotes y vencimientos</h3>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" th:field="*{gestionaLotes}" /> Gestiona lotes
                            </label>
                            <label>
                                <input type="checkbox" th:field="*{requiereVencimiento}" /> Requiere vencimiento
                            </label>
                        </div>

                        <div class="form-grid" style="margin-top: 1rem;">
                            <div class="form-group">
                                <label for="vidaUtilDias">Vida Útil (días)</label>
                                <input type="number" id="vidaUtilDias" th:field="*{vidaUtilDias}" class="form-control" min="0" placeholder="p. ej. 180" />
                                <small class="form-text text-muted">Días desde fabricación hasta vencimiento</small>
                            </div>

                            <div class="form-group">
                                <label for="almacenamiento">Almacenamiento <span style="color:red;">*</span></label>
                                <select id="almacenamiento" th:field="*{almacenamiento}" class="form-control" required>
                                    <option th:each="a : ${T(merko.merko.Entity.Almacenamiento).values()}" th:value="${a}" th:text="${#strings.capitalize(#strings.replace(a.name(), '_', ' '))}"></option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="registroSanitario">Registro Sanitario</label>
                                <input type="text" id="registroSanitario" th:field="*{registroSanitario}" class="form-control" placeholder="INVIMA / otro" />
                            </div>
                        </div>
                    </div>

                    <!-- Sección: Imagen -->
                    <div class="form-section">
                        <h3><i class="fas fa-image"></i> Imagen</h3>
                        <div class="form-group" th:if="${producto.id != null && producto.imagenUrl != null}">
                            <label>Imagen Actual:</label>
                            <div>
                                <img th:src="@{${producto.imagenUrl}}" alt="Imagen actual" style="max-width: 200px; border-radius: 6px; border: 2px solid #e2e8f0; margin-top: 0.5rem;">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="imagen">Imagen del Producto:</label>
                            <input type="file" id="imagen" name="imagen" class="form-control" accept="image/*" />
                            <small class="form-text text-muted">Selecciona una imagen para el producto (JPG, PNG)</small>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-check-circle"></i> 
                            Guardar Cambios
                        </button>
                        <a th:href="@{/admin/productos}" class="btn btn-secondary">
                            <i class="fas fa-times-circle"></i> 
                            Cancelar
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </body>
    <th:block layout:fragment="scripts">
        <script th:src="@{/js/pages/productos/form.js}"></script>
    </th:block>
    </html>
