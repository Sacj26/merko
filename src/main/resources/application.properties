spring.application.name=merko

# Puerto dinámico para Railway (usa PORT del ambiente, 8080 por defecto)
server.port=${PORT:8080}

# ============================================
# LOCAL MYSQL DATABASE CONFIGURATION (Desarrollo - COMENTADO)
# ============================================
# spring.datasource.url=jdbc:mysql://localhost:3306/merko?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC
# spring.datasource.username=root
# spring.datasource.password=26092003.Sebas
# spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
# spring.datasource.hikari.maximum-pool-size=10
# spring.datasource.hikari.minimum-idle=5
# spring.datasource.hikari.connection-timeout=20000

# ============================================
# AZURE MYSQL (Producción - ACTIVO)
# ============================================
spring.datasource.url=jdbc:mysql://merko-def.mysql.database.azure.com:3306/merko?useSSL=false&allowPublicKeyRetrieval=true&serverTimezone=UTC&useServerPrepStmts=true&cachePrepStmts=true&prepStmtCacheSize=250&prepStmtCacheSqlLimit=2048&rewriteBatchedStatements=true&useCompression=true&autoReconnect=true&failOverReadOnly=false&maxReconnects=10
spring.datasource.username=admin_
spring.datasource.password=26092003.Sebas
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Pool de conexiones OPTIMIZADO para Azure (mayor pool por latencia de red)
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=120000
spring.datasource.hikari.keepalive-time=300000

spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect
spring.jpa.properties.hibernate.format_sql=false

# Optimizaciones de rendimiento (especialmente para Azure)
spring.jpa.properties.hibernate.jdbc.batch_size=50
spring.jpa.properties.hibernate.jdbc.fetch_size=50
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.query.in_clause_parameter_padding=true
spring.jpa.properties.hibernate.query.plan_cache_max_size=2048
spring.jpa.properties.hibernate.query.plan_parameter_metadata_max_size=128

# Optimización de lazy loading - evita N+1 queries
spring.jpa.properties.hibernate.enable_lazy_load_no_trans=false
spring.jpa.open-in-view=false

# Cache de segundo nivel (DESACTIVADO para Railway - memoria limitada)
spring.jpa.properties.hibernate.cache.use_second_level_cache=false
spring.jpa.properties.hibernate.cache.use_query_cache=false
# spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.jcache.JCacheRegionFactory
# spring.jpa.properties.hibernate.javax.cache.provider=org.ehcache.jsr107.EhcacheCachingProvider

# Reducir queries de existencia
spring.jpa.properties.hibernate.jdbc.use_get_generated_keys=true

# Pool de conexiones HikariCP (reducido para Railway)
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000
spring.datasource.hikari.leak-detection-threshold=60000

# Desactivar caché de Thymeleaf en desarrollo
spring.thymeleaf.cache=false

# ============================================
# GOOGLE OAUTH2 CONFIGURATION
# ============================================
spring.security.oauth2.client.registration.google.client-id=560225093878-sp6pvvr94n6ij8hnvfrvdkh436s1vbbu.apps.googleusercontent.com
spring.security.oauth2.client.registration.google.client-secret=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
spring.security.oauth2.client.registration.google.scope=profile,email
spring.security.oauth2.client.registration.google.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}

# Provider configuration (opcional, Spring Boot lo detecta automáticamente)
spring.security.oauth2.client.provider.google.authorization-uri=https://accounts.google.com/o/oauth2/v2/auth
spring.security.oauth2.client.provider.google.token-uri=https://www.googleapis.com/oauth2/v4/token
spring.security.oauth2.client.provider.google.user-info-uri=https://www.googleapis.com/oauth2/v3/userinfo
spring.security.oauth2.client.provider.google.user-name-attribute=sub
